# --------------------------------
# CookieCloud Docker-compose.yml
# --------------------------------
version: '3'
services:
  cookiecloud:
    image: ghcr.io/workerspages/cookiecloud:cookiecloud-metube-block-server
    container_name: cookiecloud
    restart: unless-stopped
    environment:
      # --- 关键配置开始 ---
      # 你的 CookieCloud 扩展里显示的 UUID
      - METUBE_UUID=你的扩展UUID
      # 你的 CookieCloud 扩展里设置的密码
      - METUBE_PASSWORD=你的扩展密码
      # (可选) 过滤域名，避免文件过大，只保存 youtube 相关的
      - METUBE_DOMAIN_FILTER=youtube.com,google.com
      
      # SFTP 远程传输配置 (指向部署了 MeTube 的服务器 B)
      - SFTP_HOST=服务器B的IP地址
      - SFTP_PORT=22
      - SFTP_USER=root (或者其他有权限的用户名)
      - SFTP_PASSWORD=服务器B的SSH密码
      # 或者使用 SSH Key (需将 key 挂载进容器)
      # - SFTP_PRIVATE_KEY=/ssh_keys/id_rsa
      
      # 目标路径 (服务器B上的绝对路径)
      - SFTP_REMOTE_PATH=/my_data/docker_data/metube/cookies/cookies.txt
      # --- 关键配置结束 ---
    volumes:
      - ./data:/data/api/data
      # 如果使用 SSH Key 认证
      # - /root/.ssh/id_rsa:/ssh_keys/id_rsa:ro
    ports:
      - 8088:8088


# --------------------------------
# MeTube Docker-compose.yml
# --------------------------------
version: '3'
services:
  metube:
    image: alexta69/metube
    container_name: metube
    restart: unless-stopped
    ports:
      - "8081:8081"
    volumes:
      - ./downloads:/downloads
      # 这里的 ./cookies 对应服务器 A 中 SFTP_REMOTE_PATH 指向的目录
      # 例如如果服务器A写的是 /my_data/docker_data/metube/cookies/cookies.txt
      # 那么服务器B这里挂载的 ./cookies 应该就是 /my_data/docker_data/metube/cookies
      - ./cookies:/cookies
    # Metube 会自动检测 /cookies/cookies.txt，无需额外环境变量配置
